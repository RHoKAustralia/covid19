{% extends "base.html" %}
{% load static %}

{% block head %}
    <!-- bulma calendar -->
    <link rel="stylesheet" href="{% static 'css/bulma-calendar.min.css' %}"/>
    <script src="{% static 'js/bulma-calendar.min.js' %}"></script>

    <!-- bulma-steps -->
    <link rel="stylesheet" href="{% static 'css/bulma-steps.min.css' %}"/>
    <script src="{% static 'js/bulma-steps.min.js' %}"></script>

    <link rel="apple-touch-icon" sizes="180x180" href="{% static 'apple-touch-icon.png' %}"/>

    <script src="{% static 'js/fontawesome-224eab9f43.js' %}" crossorigin="anonymous"></script>

    <link rel="stylesheet" href="{% static 'css/question_list.css' %}"/>

    <!-- since nodeList.forEach is missing in IE11 -->
    <script>
      if (window.NodeList && !NodeList.prototype.forEach)
      {
        NodeList.prototype.forEach = Array.prototype.forEach;
      }
    </script>

{% endblock %}

{% block  body %}
<div class="all container">

{% if questions %}
<form method="post" action="{{PREFIX_URL}}/saveresponse">
    {% csrf_token %}
<br/>
<section class="section container">
  <h4 class="title is-4" style="is-dark">Your Progress</h4>
</section>
<div class="steps" id="stepsDemo">

  <div class="step-item is-active">
    <div class="step-marker">1</div>
  </div>
  <div class="step-item">
    <div class="step-marker">2</div>
  </div>
  <div class="step-item">
    <div class="step-marker">3</div>
  </div>
  <div class="step-item">
    <div class="step-marker">4</div>
  </div>
  <div class="step-item">
    <div class="step-marker">5</div>
  </div>
  <div class="step-item">
    <div class="step-marker">6</div>
  </div>
  <div class="step-item">
    <div class="step-marker">7</div>
  </div>
  <div class="step-item">
    <div class="step-marker">8</div>
  </div>
  <div class="step-item">
    <div class="step-marker">9</div>
  </div>
  <div class="step-item">
    <div class="step-marker">10</div>
  </div>
  <div class="step-item">
    <div class="step-marker">11</div>
  </div>
  <div class="steps-content">

    <div class="step-content is-active">
    <section class="section container">
    <script>
      function checkAge(id)
      {
        var ele = document.getElementById(id);
        if (ele.options[ele.selectedIndex].value == "<15")
        {
          document.getElementById('modalPanel').classList.add('is-active');
        }
        else
          document.getElementById('modalPanel').classList.remove('is-active');
      }

      function validateAge()
      {
        sum = 0;
{% for question in questions %}
    {% if question.isage %}
          sum += check_data_missing("{{ question.id }}");
    {% endif %}
{% endfor %}
        return sum;
      }
    </script>

{% for question in questions %}
    {% if question.isage %}
    <div class="field">
      <label class="label" id="label_{{ question.id }}">{{ question.question }}</label>
      <div class="control" id="control_{{ question.id }}">
        <div class="select">
          <select id="{{ question.id }}" name="{{ question.id }}" onChange="checkAge('{{ question.id }}');">
            <option value="" selected>--</option>
            <option value="<15">14 years or less</option>
            <option value="15-17">15-17</option>
            <option value="18-29">18-29</option>
            <option value="30-39">30-39</option>
            <option value="40-49">40-49</option>
            <option value="50-59">50-59</option>
            <option value="60-69">60-69</option>
            <option value="70-79">70-79</option>
            <option value="80-89">80-89</option>
            <option value="90+">90 and older</option>
            </select>
          </div>
        </div>
      </div>
    {% endif %}
{% endfor %}

      <div class="modal" id="modalPanel">
        <div class="modal-background"></div>
        <div class="modal-card">
          <header class="modal-card-head">
            <p class="modal-card-title">Unable to Complete Questionnaire</p>
          </header>
          <section class="modal-content-body">
            <p class="modal-card-body" id="conditions">You must be 15 years or greater to use this survey.</p>
          </section>
          <footer class="modal-card-foot">
            <button type="button" class="button" onClick="window.location='{{PREFIX_URL}}/';">OK</button>
          </footer>
        </div>
      </div>

    </div>
    </section>

    <div class="step-content is-active">
    <section class="section container">

<!--
<div class="notification is-info">
    <div class="content">
Thank you for being part of testing this Coronavirus (COVID-19) Symptom Checker.
    </div>

    <div class="content">
As you complete the questions, please make notes about anything that is not working, any words you don’t understand, or any other problems you see. Is there any question or issue that would make you not want to finish the survey? At the end, there will be a feedback box where you can leave your comments. Thank you in advance for your participation.
    </div>

    <div class="content has-text-weight-bold">
Please note, this is a confidential beta-version of the Symptom Checker. This is for your use only so please don’t forward it to others.
    </div>
</div>
-->

{% for question in questions %}
    {% if question.istested %}
        {% if question.isanswer %}
    <h4 class="title is-4" id="label_{{ question.id }}">Did you go to a medical practitioner, hospital or other health service to be tested for COVID-19 (coronavirus)?</h4>
        {% endif %}
    {% endif %}
{% endfor %}
    <script>
        function istested(id)
        {
          var value = get_radio_value(id);
          var fields = [];
{% for question in questions %}
    {% if question.istested %}
        {% if question.order == 1 or question.order == 3 %}
          fields.push("field_{{ question.id }}");
        {% endif %}
    {% endif %}
{% endfor %}

          var hide = (value == "0" || value == "2");
          for (i=0; i<fields.length; i++)
          {
            if (hide)
              document.getElementById(fields[i]).classList.add("is-hidden");
            else
              document.getElementById(fields[i]).classList.remove("is-hidden");
          }
        }

        function validateTested()
        {
          sum = 0;
{% for question in questions %}
    {% if question.istested %}
        {% if question.isanswer %}
          sum += check_data_missing("{{ question.id }}");
          val = get_radio_value("{{ question.id }}");
        {% endif %}
        {% if question.order == 1 %}
          resultval = get_radio_value("{{ question.id }}");
        {% endif %}
    {% endif %}
{% endfor %}

          if (val == "1")
          {
{% for question in questions %}
    {% if question.istested %}
        {% if question.order == 1 or question.order == 3 %}
            sum += check_data_missing("{{ question.id }}");
        {% endif %}
    {% endif %}
{% endfor %}
          }
          return sum;
        }

    </script>
{% for question in questions %}
    {% if question.istested %}
        {% if question.isanswer %}
       <div class="field">
            <div class="control" id="control_{{ question.id }}">
                <label class="radio" for="{{ question.id }}_1"><input type="radio" name="{{ question.id }}" id="{{ question.id }}_1" value="1" onchange="istested('{{ question.id }}')"/>&nbsp;Yes,&nbsp;I&nbsp;was&nbsp;tested</label>
                <br/>
                <label class="radio" for="{{ question.id }}_2"><input type="radio" name="{{ question.id }}" id="{{ question.id }}_2" value="2" onchange="istested('{{ question.id }}')"/>&nbsp;Yes,&nbsp;but&nbsp;I&nbsp;was&nbsp;not&nbsp;tested</label>
                <br/>
                <label class="radio" for="{{ question.id }}_0"><input type="radio" name="{{ question.id }}" id="{{ question.id }}_0" value="0" onchange="istested('{{ question.id }}')"/>&nbsp;No</label>
            </div>
        </div>
        {% endif %}
        {% if question.order == 1 %}
       <div class="is-hidden" id="field_{{ question.id }}">
            <label class="label" id="label_{{ question.id}}">{{ question.question }}</label>
            <div class="control" id="control_{{ question.id }}">
                <label class="radio" for="{{ question.id }}_1"><input type="radio" name="{{ question.id }}" id="{{ question.id }}_1" value="1" onchange="istestedresult('{{ question.id }}');">&nbsp;Positive&nbsp;(I&nbsp;was&nbsp;found&nbsp;to&nbsp;have&nbsp;COVID-19)</label>
                <br/>
                <label class="radio" for="{{ question.id }}_0"><input type="radio" name="{{ question.id }}" id="{{ question.id }}_0" value="0" onchange="istestedresult('{{ question.id }}');">&nbsp;Negative&nbsp;(I&nbsp;didn't&nbsp;have&nbsp;COVID-19)</label>
                <br/>
                <label class="radio" for="{{ question.id }}_2"><input type="radio" name="{{ question.id }}" id="{{ question.id }}_2" value="2" onchange="istestedresult('{{ question.id }}');">&nbsp;Don't&nbsp;know</label>
                <br/>
                <label class="radio" for="{{ question.id }}_3"><input type="radio" name="{{ question.id }}" id="{{ question.id }}_3" value="3" onchange="istestedresult('{{ question.id }}');">&nbsp;I Prefer not to say</label>
            </div>
        </div>
        {% endif%}
        {% if question.order == 3 %}
        <div class="is-hidden" id="field_{{ question.id }}">
            <label class="label" id="label_{{ question.id }}">{{ question.question }}</label>
            <div class="control" id="control_{{ question.id }}">
                <input class="is-size-6 has-text-dark" type="date" name="{{ question.id }}" id="{{ question.id }}" value="">
            </div>
        </div>
        {% endif %}
    {% endif %}
{% endfor %}
    </section>
    </div>

    <div class="step-content">
    <section class="section container">
{% for question in questions %}
    {% if question.iscontact%}
        {% if question.isanswer %}
    <h4 class="title is-4" id="label_{{ question.id }}">Have you been in contact with anyone confirmed to have COVID-19?</h4>
        {% endif %}
    {% endif %}
{% endfor %}

        <script>
        function iscontact(id)
        {
          var value = get_radio_value(id);
          var fields = ["field_iscontact"];
{% for question in questions %}
    {% if question.iscontact %}
        {% if not question.isanswer %}
          fields.push("field_{{ question.id }}");
        {% endif %}
    {% endif %}
{% endfor %}
          var className = (value == "0" || value == "2") ? "is-hidden" : "field";
          for (i=0; i<fields.length; i++)
          {
            document.getElementById(fields[i]).className = className;
          }
        }

        function validateContact()
        {
          sum = 0;
{% for question in questions %}
    {% if question.iscontact%}
        {% if question.isanswer %}
          sum += check_data_missing("{{ question.id }}");
          val = get_radio_value("{{ question.id }}");
        {% endif %}
    {% endif %}
{% endfor %}
          if (val == "1")
          {
            sum += check_data_missing("iscontact_location");
{% for question in questions %}
    {% if question.iscontact %}
        {% if question.order == 1 %}
            sum += check_data_missing("{{ question.id }}");
        {% endif %}
    {% endif %}
{% endfor %}
          }
          return sum;
        }
        </script>

{% for question in questions %}
    {% if question.iscontact %}
        {% if question.isanswer %}
        <div class="field">
            <div class="control" id="control_{{ question.id }}">
                <label class="radio" for="{{ question.id }}_1"><input type="radio" name="{{ question.id }}" id="{{ question.id }}_1" value="1" onchange="iscontact('{{ question.id }}')">&nbsp;Yes</label>
                <br/>
                <label class="radio" for="{{ question.id }}_0"><input type="radio" name="{{ question.id }}" id="{{ question.id }}_0" value="0" onchange="iscontact('{{ question.id }}')">&nbsp;No</label>
                <br/>
                <label class="radio" for="{{ question.id }}_2"><input type="radio" name="{{ question.id }}" id="{{ question.id }}_2" value="2" onchange="iscontact('{{ question.id }}')">&nbsp;Unsure</label>
            </div>
        </div>
        <div class="field is-hidden" id="field_iscontact">
           <label class="label" id="label_iscontact_location">Which town or city did the interaction occur in?</label>
           <div class="control" id="control_iscontact_location">
               <input id="iscontact_location" name="iscontact_location" type="text" class="input" placeholder="Search"/>
               <input type="hidden" class="control" name="iscontact_location_json" id="iscontact_location_json"/>
           </div>
        </div>
        {% elif question.order == 1 %}
        <div class="field is-hidden" id="field_{{ question.id }}">
          <label class="label" id="label_{{ question.id }}">{{ question.question }}</label>
          <div class="control has-icon has-icon-right">
             <label class="radio" for="{{ question.id }}_0"><input type="radio" name="{{ question.id }}" id="{{ question.id }}_0" value="0">&nbsp;You were in close face-to face contact for <b>more than 15 minutes</b> in the 24 hours before they showed symptoms</label><br/>
             <label class="radio" for="{{ question.id }}_1"><input type="radio" name="{{ question.id }}" id="{{ question.id }}_1" value="1">&nbsp;You were in face-to-face contact for <b>less than 15 minutes</b> in the 24 hours before they showed symptoms</label><br/>
             <label class="radio" for="{{ question.id }}_2"><input type="radio" name="{{ question.id }}" id="{{ question.id }}_2" value="2">&nbsp;You shared a closed space (e.g., same household, in a car or a work place) for more than two hours in the 24 hours before they showed symptoms</label><br/>
             <label class="radio" for="{{ question.id }}_3"><input type="radio" name="{{ question.id }}" id="{{ question.id }}_3" value="3">&nbsp;You shared a closed space for <b>less than two hours</b> in the 24 hours before they showed symptoms</label>
           </div>
        </div>
        {% else %}
        <div class="field is-hidden" id="field_{{ question.id }}">
           <!--<label class="label">{{ question.question }}</label>-->
           <div class="control" id="control_{{ question.id }}">
               <input class="input" type="hidden" id="{{ question.id }}" name="{{ question.id }}">
            </div>
        </div>
        {% endif %}
    {% endif %}
{% endfor %}
    </section>
    </div>

    <div class="step-content">
    <section class="section container">
    <script>
        function istravel(id)
        {
          var value = get_radio_value(id);
          var fields = ["field_istravel"];
          {% for question in questions %}
              {% if question.istravel %}
                  {% if not question.isanswer %}
          fields.push("field_{{ question.id }}");
                  {% endif %}
              {% endif %}
          {% endfor %}
          if (value == "Yes-to")
          {
            document.getElementById("field_istravel_to").classList.remove("is-hidden");
            document.getElementById("field_istravel_from").classList.add("is-hidden");
          }
          else if (value == "Yes-from")
          {
            document.getElementById("field_istravel_to").classList.add("is-hidden");
            document.getElementById("field_istravel_from").classList.remove("is-hidden");
          }
          else
          {
            document.getElementById("field_istravel_to").classList.add("is-hidden");
            document.getElementById("field_istravel_from").classList.add("is-hidden");
          }
        }

        function validateTravel()
        {
          sum = 0;
{% for question in questions %}
    {% if question.istravel%}
        {% if question.isanswer %}
          sum += check_data_missing("{{ question.id }}");
          val = get_radio_value("{{ question.id }}");
        {% endif %}
    {% endif %}
{% endfor %}
          if (val == "Yes-to")
          {
            sum += check_data_missing("istravel_to_location");
          }
          if (val == "Yes-from")
          {
            sum += check_data_missing("istravel_from_location");
          }
          return sum;
        }
    </script>
{% for question in questions %}
    {% if question.istravel %}
        {% if question.isanswer %}
    <h4 class="title is-4" id="label_{{ question.id }}">Have you travelled internationally in the past 14 days?</h4>
        <div class="field">
            <div class="control" id="control_{{ question.id }}">
                <label class="radio" for="{{ question.id }}_Yes-to"><input type="radio" name="{{ question.id }}" id="{{ question.id }}_Yes-to" value="Yes-to" onchange="istravel('{{ question.id }}')">&nbsp;Yes&nbsp;-&nbsp;I travelled <b>to</b> another country</label><br/>
                <label class="radio" for="{{ question.id }}_Yes-from"><input type="radio" name="{{ question.id }}" id="{{ question.id }}_Yes-from" value="Yes-from" onchange="istravel('{{ question.id }}')">&nbsp;Yes&nbsp;-&nbsp;I travelled <b>from</b> another country</label><br/>
                <label class="radio" for="{{ question.id }}_No"><input type="radio" name="{{ question.id }}" id="{{ question.id }}_No" value="No" onchange="istravel('{{ question.id }}')">&nbsp;No</label>
            </div>
        </div>
        <div class="field is-hidden" id="field_istravel_to">
          <label class="label" id="label_istravel_to_location">Which city in that country did you travel to?</label>
          <div class="control" id="control_istravel_to_location">
              <input id="istravel_to_location" name="istravel_to_location" type="text" class="input" placeholder="Search"/>
              <input type="hidden" class="control" name="istravel_to_location_json" id="istravel_to_location_json"/>
          </div>
        </div>
        <div class="field is-hidden" id="field_istravel_from">
          <label class="label" id="label_istravel_from_location">Which city in that country did you travel from?</label>
          <div class="control" id="control_istravel_from_location">
              <input id="istravel_from_location" name="istravel_from_location" type="text" class="input" placeholder="Search"/>
              <input type="hidden" class="control" name="istravel_from_location_json" id="istravel_from_location_json"/>
          </div>
        </div>
        {% else %}
        <div class="is-hidden" id="field_{{ question.id}}">
            <!--<label class="label">{{ question.question }}</label>-->
            <div class="control" id="control_{{ question.id }}">
                <input class="input" type="hidden" id="{{ question.id }}" name="{{ question.id }}">
            </div>
        </div>
        {% endif %}
    {% endif %}
{% endfor %}
    </section>
    </div>

    <div class="step-content">
    <section class="section container">
    <script>
        function isisolating(id)
        {
          var value = get_radio_value(id);
          var yes_field;
          var difficult_field;
{% for question in questions %}
    {% if question.isisolating %}
        {% if question.order == 2 %}
          yes_field = "field_{{ question.id }}";
        {% elif question.order == 1 %}
          difficult_field = "field_{{ question.id }}";
        {% endif %}
    {% endif %}
{% endfor %}
          if (value == "1")
          {
            document.getElementById(yes_field).classList.remove("is-hidden");
            document.getElementById(difficult_field).classList.add("is-hidden");
          }
          else if (value == "0")
          {
            document.getElementById(yes_field).classList.add("is-hidden");
            document.getElementById(difficult_field).classList.add("is-hidden");
          }
          else if (value == "2")
          {
            document.getElementById(yes_field).classList.add("is-hidden");
            document.getElementById(difficult_field).classList.remove("is-hidden");
          }
        }

        function validateIsolating()
        {
          sum = 0;
{% for question in questions %}
    {% if question.isisolating %}
        {% if question.isanswer %}
          sum += check_data_missing("{{ question.id }}");
          val = get_radio_value("{{ question.id }}");
        {% endif %}
    {% endif %}
{% endfor %}
          if (val == "2")
          {
{% for question in questions %}
    {% if question.isisolating %}
        {% if question.order == 1 %}
            sum += check_data_missing("{{ question.id }}");
        {% endif %}
    {% endif %}
{% endfor %}
          }
          if (val == "1")
          {
{% for question in questions %}
    {% if question.isisolating %}
        {% if question.order == 2 %}
            sum += check_data_missing("{{ question.id }}");
        {% endif %}
    {% endif %}
{% endfor %}
          }
          return sum;
        }
    </script>

{% for question in questions %}
    {% if question.isisolating %}
        {% if question.isanswer %}
    <h4 class="title is-4" id="label_{{ question.id }}">Are you in self-isolation?</h4>
    <div class="content">Self-isolation means staying at home and avoiding contact with other people.</div>
    <div class="field">
        <div class="control" id="control_{{ question.id }}">
            <label class="radio" for="{{ question.id }}_1">
            <input type="radio" name="{{ question.id }}" id="{{ question.id }}_1" value="1" onChange="isisolating('{{ question.id }}')">&nbsp;Yes</label>
            <br/>
            <label class="radio" for="{{ question.id }}_0">
            <input type="radio" name="{{ question.id }}" id="{{ question.id }}_0" value="0" onChange="isisolating('{{ question.id }}')">&nbsp;No</label>
            <br/>
            <label class="radio" for="{{ question.id }}_2">
            <input type="radio" name="{{ question.id }}" id="{{ question.id }}_2" value="2" onChange="isisolating('{{ question.id }}')">&nbsp;I&nbsp;tried,&nbsp;but&nbsp;it&nbsp;was&nbsp;too&nbsp;difficult.</label>
        </div>
    </div>
        {% elif question.order == 1 %}
    <div class="field is-hidden" id="field_{{ question.id }}">
        <label class="label" id="label_{{ question.id }}">{{ question.question }}</label>
        <div class="control" id="control_{{ question.id }}">
            <input class="input" type="text" placeholder="Enter text" id="{{ question.id }}" name="{{ question.id }}">
        </div>
    </div>
    {% else %}
    <div class="field is-hidden" id="field_{{ question.id }}">
        <label class="label" id="label_{{ question.id }}">{{ question.question }}</label>
        <div class="control" id="control_{{ question.id }}">
            <input class="input" type="text" placeholder="Enter text" id="{{ question.id }}" name="{{ question.id }}">
        </div>
    </div>
        {% endif %}
    {% endif %}
{% endfor %}
    </section>
    </div>

    <div class="step-content">
    <section class="section container">
    <script>
        function isflu(id)
        {
          var value = get_radio_value(id);
          var field = "";
{% for question in questions %}
    {% if question.isflu %}
        {% if question.alias == "lunginfection" %}
          field = "field_{{ question.id }}";
        {% endif %}
    {% endif %}
{% endfor %}

          if (value == "0")
            document.getElementById(field).classList.remove("is-hidden");
          else
            document.getElementById(field).classList.add("is-hidden");
        }

        function validateFlu()
        {
          sum = 0;
{% for question in questions %}
    {% if question.isflu %}
        {% if question.alias == "haveinfluenza" %}
          sum += check_data_missing("{{ question.id }}");
          val = get_radio_value("{{ question.id }}");
        {% endif %}
    {% endif %}
{% endfor %}
          if (val == "0")
          {
{% for question in questions %}
    {% if question.isflu %}
        {% if question.alias == "lunginfection" %}
            sum += check_data_missing("{{ question.id }}");
        {% endif %}
    {% endif %}
{% endfor %}
          }
          return sum;
        }
    </script>

{% for question in questions %}
    {% if question.isflu %}
        {% if question.alias == "haveinfluenza" %}
    <h4 class="title is-4" id="label_{{ question.id }}">Do you have influenza or other lung infection that is <u>not</u> COVID-19?</h4>
    <div class="field">
        <div class="control has-icon has-icon-right">
            <label class="radio" for="{{ question.id }}_0"><input type="radio" name="{{ question.id }}" id="{{ question.id }}_0" value="0" onChange="isflu('{{ question.id }}');">&nbsp;Yes</label><br/>
            <label class="radio" for="{{ question.id }}_1"><input type="radio" name="{{ question.id }}" id="{{ question.id }}_1" value="1" onChange="isflu('{{ question.id }}');">&nbsp;No</label><br/>
            <label class="radio" for="{{ question.id }}_2"><input type="radio" name="{{ question.id }}" id="{{ question.id }}_2" value="2" onChange="isflu('{{ question.id }}');">&nbsp;Don't Know</label>
        </div>
    </div>
        {% else %}
    <div class="field is-hidden" id="field_{{ question.id }}">
        <label class="label" id="label_{{ question.id }}">{{ question.question }}</label>
        <div class="control" id="control_{{ question.id }}">
            <input class="input" type="text" placeholder="Enter text" id="{{ question.id }}" name="{{ question.id }}">
        </div>
    </div>
        {% endif %}
    {% endif %}
{% endfor %}

    </section>
    </div>


    <div class="step-content">
    <section class="section container">
    <div class="content">
It is important to record, in detail, if you do or don’t have symptoms today. This helps to understand what is going on across the entire community and if there are changes over time.
    </div>

    <div class="content">
Please answer all questions each time you do the Symptom Checker (preferably once per day).
    </div>

    <h4 class="title is-4"><u>Since this time yesterday</u>, have you had the following symptoms? *</h4>

    <script>
        function validateSymptoms()
        {
          sum = 0;
{% for question in questions %}
    {% if question.isscale %}
          sum += check_data_missing("{{ question.id }}");
    {% endif %}
{% endfor %}
          return sum;
        }
    </script>

{% for question in questions %}
    {% if question.isscale %}
    <div class="field">
        <label class="label" id="label_{{ question.id }}">{{ question.question }}</label>
        <div class="control has-icon has-icon-right">
            <label class="radio" for="{{ question.id }}_0"><input type="radio" name="{{ question.id }}" id="{{ question.id }}_0" value="0">&nbsp;None</label>
            <label class="radio" for="{{ question.id }}_1"><input type="radio" name="{{ question.id }}" id="{{ question.id }}_1" value="1">&nbsp;Mild</label>
            <label class="radio" for="{{ question.id }}_2"><input type="radio" name="{{ question.id }}" id="{{ question.id }}_2" value="2">&nbsp;Moderate</label>
            <label class="radio" for="{{ question.id }}_3"><input type="radio" name="{{ question.id }}" id="{{ question.id }}_3" value="3">&nbsp;Severe</label>
        </div>
    </div>
    {% endif %}
{% endfor %}

    <div class="content is-size-7">
* Influenza intensity and impact questionnaire (Flu-iiQ)&trade; &copy;RH Osborne (2006). No part of the Flu-iiQ&trade; may be copied or reproduced in any form without written permission from the author. Used under license to Swinburne University of Technology.
    </div>

    </section>
    </div>

    <div class="step-content">
    <section class="section container">
    <script>
        function validateDifficulty()
        {
          sum = 0;
{% for question in questions %}
    {% if question.isdifficulty %}
          sum += check_data_missing("{{ question.id }}");
    {% endif %}
{% endfor %}
          return sum;
        }
    </script>
    <h4 class="title is-4"><u>Since this time yesterday</u>, have you had difficulty to: *</h4>
{% for question in questions %}
    {% if question.isdifficulty %}
    <div class="field">
        <div class="control" id="control_{{ question.id }}">
            <label class="label" id="label_{{ question.id }}">{{ question.question }}</label>
            <div class="control">
                <label class="radio" for="{{ question.id }}_0"><input type="radio" name="{{ question.id }}" id="{{ question.id }}_0" value="0">&nbsp;None</label>
                <label class="radio" for="{{ question.id }}_1"><input type="radio" name="{{ question.id }}" id="{{ question.id }}_1" value="1">&nbsp;Some</label>
                <label class="radio" for="{{ question.id }}_2"><input type="radio" name="{{ question.id }}" id="{{ question.id }}_2" value="2">&nbsp;Moderate</label>
                <label class="radio" for="{{ question.id }}_3"><input type="radio" name="{{ question.id }}" id="{{ question.id }}_3" value="3">&nbsp;Great Difficulty</label>
            </div>
        </div>
    </div>
    {% endif %}
{% endfor %}

    <div class="content is-size-7">
* Influenza intensity and impact questionnaire (Flu-iiQ)&trade; &copy;RH Osborne (2006). No part of the Flu-iiQ&trade; may be copied or reproduced in any form without written permission from the author. Used under license to Swinburne University of Technology.
    </div>
    </section>
    </div>

    <div class="step-content">
    <section class="section container">

    <h4 class="title is-4">Some details about you</h4>

    <script>
      function checkAge(id)
      {
        var ele = document.getElementById(id);
        if (ele.options[ele.selectedIndex].value == "<15")
        {
          document.getElementById('modalPanel').classList.add('is-active');
        }
        else
          document.getElementById('modalPanel').classList.remove('is-active');
      }

      function validateAbout()
      {
        sum = 0;
{% for question in questions %}
    {% if question.isaboutyou %}
          sum += check_data_missing("{{ question.id }}");
          sum += check_data_missing("aboutyou_location");
    {% endif %}
{% endfor %}
        return sum;
      }
    </script>

{% for question in questions %}
    {% if question.isaboutyou %}
        {% if question.order == 0 %}
        <div class="field">
          <label class="label" id="label_aboutyou_location">What area, town or city are you in now?</label>
          <div class="control" id="control_aboutyou_location">
              <input id="aboutyou_location" name="aboutyou_location" type="text" class="input" placeholder="Search"/>
              <input type="hidden" class="control" name="aboutyou_location_json" id="aboutyou_location_json"/>
          </div>
        </div>
        {% endif %}
    {% endif %}
{% endfor %}
{% for question in questions %}
    {% if question.ispostcode %}
        <div class="field">
            <label class="label">{{ question.question }}</label>
            <div class="control" id="control_{{ question.id }}">
                <input class="input" type="text" id="{{ question.id }}" name="{{ question.id }}">
            </div>
        </div>
    {% endif %}
{% endfor %}
{% for question in questions %}
    {% if question.isaboutyou %}
        {% if question.order == 1 %}
        <div class="field">
            <label class="label" id="label_{{ question.id }}">{{ question.question }}</label>
            <div class="control" id="control_{{ question.id }}">
                <label class="radio" for="{{ question.id }}_Female"><input type="radio" name="{{ question.id }}" id="{{ question.id }}_Female" value="Female"/>&nbsp;Female</label>
                <br/>
                <label class="radio" for="{{ question.id }}_Male"><input type="radio" name="{{ question.id }}" id="{{ question.id }}_Male" value="Male"/>&nbsp;Male</label>
                <br/>
                <label class="radio" for="{{ question.id }}_Other"><input type="radio" name="{{ question.id }}" id="{{ question.id }}_Other" value="Other"/>&nbsp;Other</label>
            </div>
        </div>
        {% elif question.order == 2 or question.order == 5 or question.order == 6 %}
        <div class="field">
            <label class="label" id="label_{{ question.id }}">{{ question.question }}</label>
            <div class="control" id="control_{{ question.id }}">
                <label class="radio" for="{{ question.id }}_Yes">
                <input type="radio" name="{{ question.id }}" id="{{ question.id }}_Yes" value="Yes"/>&nbsp;Yes</label>
                <br/>
                <label class="radio" for="{{ question.id }}_No">
                <input type="radio" name="{{ question.id }}" id="{{ question.id }}_No" value="No"/>&nbsp;No</label>
            </div>
        </div>
        {% elif question.order == 3 %}
        <div class="field">
            <label class="label" id="label_{{ question.id }}">{{ question.question }}</label>
            <div class="control" id="control_{{ question.id }}">
                <input class="input" type="text" placeholder="Language spoken at home" value="English" id="{{ question.id }}" name="{{ question.id }}">
            </div>
        </div>
        {% elif question.order == 4 %}
        <div class="field">
            <label class="label" id="label_{{ question.id }}">{{ question.question }}</label>
            <div class="control" id="control_{{ question.id }}">
                <div class="select">
                    <select id="{{ question.id }}" name="{{ question.id }}">
                        <option value="" selected>--</option>
                        <option value="Full-time work">Full-time work</option>
                        <option value="Part-time work">Part-time work</option>
                        <option value="Casual employee">Casual employee</option>
                        <option value="Self employed">Self employed</option>
                        <option value="Home Duties">Home Duties</option>
                        <option value="Unemployed">Unemployed</option>
                        <option value="Student">Student</option>
                        <option value="Retired">Retired</option>
                    </select>
                </div>
            </div>
        </div>
        {% elif question.order == 7 %}
        <div class="field">
            <label class="label" id="label_{{ question.id }}">{{ question.question }}</label>
            <div class="control" id="control_{{ question.id }}">
                <div class="select">
                    <select id="{{ question.id }}" name="{{ question.id }}">
                        <option value="" selected>--</option>
                        <option value="1">1</option>
                        <option value="2">2</option>
                        <option value="3">3</option>
                        <option value="4">4</option>
                        <option value="5">5</option>
                        <option value="6">6</option>
                        <option value="7">7</option>
                        <option value="8">8</option>
                        <option value="9">9</option>
                        <option value="10+">10+</option>
                    </select>
                </div>
            </div>
        </div>

        {% endif %}
    {% endif %}

    {% if question.iscountry %}
        <div class="field has-background-danger">
            <!--<label class="label">{{ question.question }}</label>-->
            <div class="control" id="control_{{ question.id }}">
                <input class="input" type="hidden" id="{{ question.id }}" name="{{ question.id }}">
            </div>
        </div>
    {% endif %}
    {% if question.istown %}
        <div class="field">
            <!--<label class="label">{{ question.question }}</label>-->
            <div class="control" id="control_{{ question.id }}">
                <input class="input" type="hidden" id="{{ question.id }}" name="{{ question.id }}">
            </div>
        </div>
    {% endif %}
    {% if question.isregion %}
        <div class="field">
            <!--<label class="label">{{ question.question }}</label>-->
            <div class="control" id="control_{{ question.id }}">
                <input class="input" type="hidden" id="{{ question.id }}" name="{{ question.id }}">
            </div>
        </div>
    {% endif %}
{% endfor %}
    </section>
    </div>

    <div class="step-content">
    <section class="section container">
    <h4 class="title is-4">Optional: Do you have any of the following long-term conditions?</h4>
    <div class="field">
{% for question in questions %}
    {% if question.islongterm %}
        <label class="checkbox-inline">
          <input type="checkbox" data-toggle="toggle" off="No" on="Yes">&nbsp;{{ question.question }}
        </label>
        <br/>
    {% endif %}
{% endfor %}
    </div>
    </section>
    </div>

    <div class="step-content">
      <section class="section container">
      <input class="input" type="hidden" id="uid" name="uid"/>
      <input class="input" type="hidden" id="UserAgent" name="UserAgent"/>
      <input class="input" type="hidden" id="IsMobile" name="IsMobile"/>
      <div class="content">
Thank you for testing the Symptom Checker. If you have any comments about your experience using the Symptom Checker, please let us know in the feedback box below.
      </div>

      <div class="control">
          <textarea class="textarea" type="textarea" class="control" name="feedback" id="feedback"></textarea>
      </div>

      <br/>

      <div class="content">
        <button class="button is-success">
          <span class="icon is-small">
            <i class="fas fa-check"></i>
          </span>
          <span>Save</span>
        </button>
       </div>
  </section>
  </div>

  </div>
  <div class="steps-actions container">
    <div class="steps-action">
      <a href="#" data-nav="previous" class="button is-light">
        &larr; Previous
      </a>
    </div>
    <div class="steps-action">
      <a href="#" data-nav="next" class="button is-light">
        Next &rarr;
      </a>
    </div>
  </div>
</div>

</form>
{% else %}
    <p>No questions are available.</p>
{% endif %}
</div>

{% endblock %}

{% block js_end %}
<!-- bulma calendars -->
<script>
  var today = new Date();
  var dd = String(today.getDate());
  var mm = String(today.getMonth() + 1); //January is 0!
  var yyyy = today.getFullYear();
  var today_str = mm + '/' + dd + '/' + yyyy;
  // Initialize all input of type date
  var calendar_options = [];
  calendar_options["showHeader"] = false;
  calendar_options["showButtons"] = false;
  calendar_options["maxDate"] = today_str;
  var calendars = bulmaCalendar.attach('[type="date"]', calendar_options);

  // prevent the clear button from submitting the form
  var clearbuttons = document.getElementsByClassName('datetimepicker-clear-button');
  for (var i = 0; i< clearbuttons.length; i++) {
    clearbuttons[i].disabled = true;
  }
</script>
<!-- Google Places API-->
<script type="text/javascript" src="https://maps.googleapis.com/maps/api/js?key=AIzaSyCr9vma0ZPVFLmkOESuqK4tHNrfwtnyVaM&libraries=places"></script>
<!-- Google Places Configuration-->
<script>

  google.maps.event.addDomListener(window, 'load', initialize);

  function initialize()
  {
    // Create bounds from Australia
    var bounds = new google.maps.LatLngBounds(
      new google.maps.LatLng(-44, 113),
      new google.maps.LatLng(-10, 154)
    );

    init_loc(bounds, "(regions)", "istravel_to", { "locality": "24", "administrative_area_level_1": "52", "country": "25", "postal_code": "23" });
    init_loc(bounds, "(regions)", "istravel_from", { "locality": "24", "administrative_area_level_1": "52", "country": "25", "postal_code": "23" });
    init_loc(bounds, "(regions)", "iscontact", { "locality": "34", "administrative_area_level_1": "35", "country": "36", "postal_code": "33" });
    init_loc(bounds, "(regions)", "aboutyou", { "locality": "40", "administrative_area_level_1": "41", "country": "39", "postal_code": "42" });
  }

  function init_loc(bounds, type, prefix, ids)
  {
    // Create a new session token.
    var sessionToken = new google.maps.places.AutocompleteSessionToken();
    var options = {
      bounds: bounds,
      types: [type],
      sessionToken: sessionToken
    }
    var input = document.getElementById(prefix + '_location');
    var autocomplete = new google.maps.places.Autocomplete(input, options);
    autocomplete.setFields(["address_components", "geometry"]);
    autocomplete.addListener('place_changed', function () {
      var place = autocomplete.getPlace();
      var place_str = JSON.stringify(place, null, 4);
      document.getElementById(prefix + '_location_json').value = place_str;
      addr = place["address_components"];
      var types = ["locality", "administrative_area_level_1", "country", "postal_code"];
      for (i=0; i<addr.length; i++)
      {
        for (j=0; j<types.length; j++)
        {
          if (addr[i].types.includes(types[j]))
          {
            var id = ids[types[j]]
            try {
              document.getElementById(id).value = addr[i]["long_name"];
            } catch(err) {
              alert("element type " + types[j] + " with id " + id + " did not exist for prefix=" + prefix);
            }
          }
        }
      }
    });
  }
</script>
<script>

  new bulmaSteps(
    document.querySelectorAll('.steps')[0], {
      beforeNext: function(id) {
        error_count = 0
        if (id == 0) error_count += validateAge();
        if (id == 1) error_count += validateTested();
        if (id == 2) error_count += validateContact();
        if (id == 3) error_count += validateTravel();
        if (id == 4) error_count += validateIsolating();
        if (id == 5) error_count += validateFlu();
        if (id == 6) error_count += validateSymptoms();
        if (id == 7) error_count += validateDifficulty();
        if (id == 8) error_count += validateAbout();
        if (error_count > 0)
        {
          alert("Please provide input for fields marked red");
          return ["Please check for missing input"];
        }
      },
      onShow: function (id) { window.scrollTo(0, 0); }
    }
  )
</script>
<script>
  var uid = ""
{% if tracked %}
  uid = getCookie("uid");
  if (uid == "") {
    uid = chr4() + chr4() +
          '-' + chr4() +
          '-' + chr4() +
          '-' + chr4() +
          '-' + chr4() + chr4() + chr4();
   }
   setCookie("uid", uid, 365);
{% endif %}
 document.getElementById("uid").value = uid;

  document.getElementById("UserAgent").value = navigator.userAgent;
  var isMobile = (typeof window.orientation !== "undefined") || (navigator.userAgent.indexOf('IEMobile') !== -1);
  document.getElementById("IsMobile").value = String(isMobile);

</script>
{% endblock %}
